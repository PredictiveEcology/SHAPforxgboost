<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>SHAP dependence plot and interaction plot, optional to be colored by a
selected feature — shap.plot.dependence • SHAPforxgboost</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="SHAP dependence plot and interaction plot, optional to be colored by a
selected feature — shap.plot.dependence" />
<meta property="og:description" content="This function by default makes a simple dependence plot with feature values
on the x-axis and SHAP values on the y-axis, optional to color by another
feature. It is optional to use a different variable for SHAP values on the
y-axis, and color the points by the feature value of a designated variable.
Not colored if color_feature is not supplied. If data_int (the
SHAP interaction values dataset) is supplied, it will plot the interaction
effect between y and x on the y-axis. Dependence plot is easy
to make if you have the SHAP values dataset from predict.xgb.Booster
or predict.lgb.Booster.
It is not necessary to start with the long format data, but since that is
used for the summary plot, we just continue to use it here." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SHAPforxgboost</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/lightgbm.html">Using SHAPforxgboost with LightGBM</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/liuyanguu/SHAPforxgboost/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>SHAP dependence plot and interaction plot, optional to be colored by a
selected feature</h1>
    <small class="dont-index">Source: <a href='https://github.com/liuyanguu/SHAPforxgboost/blob/master/R/SHAP_funcs.R'><code>R/SHAP_funcs.R</code></a></small>
    <div class="hidden name"><code>shap.plot.dependence.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function by default makes a simple dependence plot with feature values
on the x-axis and SHAP values on the y-axis, optional to color by another
feature. It is optional to use a different variable for SHAP values on the
y-axis, and color the points by the feature value of a designated variable.
Not colored if <code>color_feature</code> is not supplied. If <code>data_int</code> (the
SHAP interaction values dataset) is supplied, it will plot the interaction
effect between <code>y</code> and <code>x</code> on the y-axis. Dependence plot is easy
to make if you have the SHAP values dataset from <code>predict.xgb.Booster</code>
or <code>predict.lgb.Booster</code>.
It is not necessary to start with the long format data, but since that is
used for the summary plot, we just continue to use it here.</p>
    </div>

    <pre class="usage"><span class='fu'>shap.plot.dependence</span><span class='op'>(</span>
  <span class='va'>data_long</span>,
  <span class='va'>x</span>,
  y <span class='op'>=</span> <span class='cn'>NULL</span>,
  color_feature <span class='op'>=</span> <span class='cn'>NULL</span>,
  data_int <span class='op'>=</span> <span class='cn'>NULL</span>,
  dilute <span class='op'>=</span> <span class='cn'>FALSE</span>,
  smooth <span class='op'>=</span> <span class='cn'>TRUE</span>,
  size0 <span class='op'>=</span> <span class='cn'>NULL</span>,
  add_hist <span class='op'>=</span> <span class='cn'>FALSE</span>,
  add_stat_cor <span class='op'>=</span> <span class='cn'>FALSE</span>,
  alpha <span class='op'>=</span> <span class='cn'>NULL</span>,
  jitter_height <span class='op'>=</span> <span class='fl'>0</span>,
  jitter_width <span class='op'>=</span> <span class='fl'>0</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>data_long</th>
      <td><p>the long format SHAP values from <code><a href='shap.prep.html'>shap.prep</a></code></p></td>
    </tr>
    <tr>
      <th>x</th>
      <td><p>which feature to show on x-axis, it will plot the feature value</p></td>
    </tr>
    <tr>
      <th>y</th>
      <td><p>which shap values to show on y-axis, it will plot the SHAP value of
that feature. y is default to x, if y is not provided, just plot the SHAP
values of x on the y-axis</p></td>
    </tr>
    <tr>
      <th>color_feature</th>
      <td><p>which feature value to use for coloring, color by the
feature value. If "auto", will select the feature "c" minimizing the
variance of the shap value given x and c, which can be viewed as a
heuristic for the strongest interaction.</p></td>
    </tr>
    <tr>
      <th>data_int</th>
      <td><p>the 3-dimention SHAP interaction values array. if <code>data_int</code>
is supplied, y-axis will plot the interaction values of y (vs. x).
<code>data_int</code> is obtained from either <code>predict.xgb.Booster</code> or
<code><a href='shap.prep.interaction.html'>shap.prep.interaction</a></code></p></td>
    </tr>
    <tr>
      <th>dilute</th>
      <td><p>a number or logical, dafault to TRUE, will plot
<code>nrow(data_long)/dilute</code> data. For example, if dilute = 5 will plot
20% of the data. As long as dilute != FALSE, will plot at most half the
data</p></td>
    </tr>
    <tr>
      <th>smooth</th>
      <td><p>optional to add a <em>loess</em> smooth line, default to TRUE.</p></td>
    </tr>
    <tr>
      <th>size0</th>
      <td><p>point size, default to 1 if nobs&lt;1000, 0.4 if nobs&gt;1000</p></td>
    </tr>
    <tr>
      <th>add_hist</th>
      <td><p>whether to add histogram using <code>ggMarginal</code>, default to
TRUE. But notice the plot after adding histogram is a <code>ggExtraPlot</code> object
instead of <code>ggplot2</code> so cannot add <code>geom</code> to that anymore. Turn the
histogram off if you wish to add more <code>ggplot2</code> geoms</p></td>
    </tr>
    <tr>
      <th>add_stat_cor</th>
      <td><p>add correlation and p-value from <code><a href='https://rpkgs.datanovia.com/ggpubr/reference/stat_cor.html'>ggpubr::stat_cor</a></code></p></td>
    </tr>
    <tr>
      <th>alpha</th>
      <td><p>point transparancy, default to 1 if nobs&lt;1000 else 0.6</p></td>
    </tr>
    <tr>
      <th>jitter_height</th>
      <td><p>amount of vertical jitter (see hight in <code>geom_jitter</code>)</p></td>
    </tr>
    <tr>
      <th>jitter_width</th>
      <td><p>amount of horizontal jitter (see width in <code>geom_jitter</code>). Use values close to 0, e.g. 0.02</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>additional parameters passed to <code>geom_jitter</code></p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>be default a <code>ggplot2</code> object, based on which you could add more geom
layers.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='co'># **SHAP dependence plot**</span>

<span class='co'># 1. simple dependence plot with SHAP values of x on the y axis</span>
<span class='fu'>shap.plot.dependence</span><span class='op'>(</span>data_long <span class='op'>=</span> <span class='va'>shap_long_iris</span>, x<span class='op'>=</span><span class='st'>"Petal.Length"</span>,
                     add_hist <span class='op'>=</span> <span class='cn'>TRUE</span>, add_stat_cor <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>

<span class='co'># 2. can choose a different SHAP values on the y axis</span>
<span class='fu'>shap.plot.dependence</span><span class='op'>(</span>data_long <span class='op'>=</span> <span class='va'>shap_long_iris</span>, x<span class='op'>=</span><span class='st'>"Petal.Length"</span>,
                           y <span class='op'>=</span> <span class='st'>"Petal.Width"</span><span class='op'>)</span>

<span class='co'># 3. color by another feature's feature values</span>
<span class='fu'>shap.plot.dependence</span><span class='op'>(</span>data_long <span class='op'>=</span> <span class='va'>shap_long_iris</span>, x<span class='op'>=</span><span class='st'>"Petal.Length"</span>,
                           color_feature <span class='op'>=</span> <span class='st'>"Petal.Width"</span><span class='op'>)</span>

<span class='co'># 4. choose 3 different variables for x, y, and color</span>
<span class='fu'>shap.plot.dependence</span><span class='op'>(</span>data_long <span class='op'>=</span> <span class='va'>shap_long_iris</span>, x<span class='op'>=</span><span class='st'>"Petal.Length"</span>,
                           y <span class='op'>=</span> <span class='st'>"Petal.Width"</span>, color_feature <span class='op'>=</span> <span class='st'>"Petal.Width"</span><span class='op'>)</span>

<span class='co'># Optional to add hist or remove smooth line, optional to plot fewer data (make plot quicker)</span>
<span class='fu'>shap.plot.dependence</span><span class='op'>(</span>data_long <span class='op'>=</span> <span class='va'>shap_long_iris</span>, x<span class='op'>=</span><span class='st'>"Petal.Length"</span>,
                     y <span class='op'>=</span> <span class='st'>"Petal.Width"</span>, color_feature <span class='op'>=</span> <span class='st'>"Petal.Width"</span>,
                     add_hist <span class='op'>=</span> <span class='cn'>TRUE</span>, smooth <span class='op'>=</span> <span class='cn'>FALSE</span>, dilute <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span>

<span class='co'># to make a list of plot</span>
<span class='va'>plot_list</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>iris</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>:</span><span class='fl'>3</span><span class='op'>]</span>, <span class='va'>shap.plot.dependence</span>, data_long <span class='op'>=</span> <span class='va'>shap_long_iris</span><span class='op'>)</span>

<span class='co'># **SHAP interaction effect plot **</span>

<span class='co'># To get the interaction SHAP dataset for plotting, need to get `shap_int` first:</span>
<span class='va'>mod1</span> <span class='op'>=</span> <span class='fu'>xgboost</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/xgboost/man/xgb.train.html'>xgboost</a></span><span class='op'>(</span>
  data <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>as.matrix</a></span><span class='op'>(</span><span class='va'>iris</span><span class='op'>[</span>,<span class='op'>-</span><span class='fl'>5</span><span class='op'>]</span><span class='op'>)</span>, label <span class='op'>=</span> <span class='va'>iris</span><span class='op'>$</span><span class='va'>Species</span>,
  gamma <span class='op'>=</span> <span class='fl'>0</span>, eta <span class='op'>=</span> <span class='fl'>1</span>, lambda <span class='op'>=</span> <span class='fl'>0</span>,nrounds <span class='op'>=</span> <span class='fl'>1</span>, verbose <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
<span class='co'># Use either:</span>
<span class='va'>data_int</span> <span class='op'>&lt;-</span> <span class='fu'><a href='shap.prep.interaction.html'>shap.prep.interaction</a></span><span class='op'>(</span>xgb_mod <span class='op'>=</span> <span class='va'>mod1</span>,
                                  X_train <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>as.matrix</a></span><span class='op'>(</span><span class='va'>iris</span><span class='op'>[</span>,<span class='op'>-</span><span class='fl'>5</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'># or:</span>
<span class='va'>shap_int</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>mod1</span>, <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>as.matrix</a></span><span class='op'>(</span><span class='va'>iris</span><span class='op'>[</span>,<span class='op'>-</span><span class='fl'>5</span><span class='op'>]</span><span class='op'>)</span>,
                    predinteraction <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>

<span class='co'># if data_int is supplied, y axis will plot the interaction values of y (vs. x)</span>
<span class='fu'>shap.plot.dependence</span><span class='op'>(</span>data_long <span class='op'>=</span> <span class='va'>shap_long_iris</span>,
                           data_int <span class='op'>=</span> <span class='va'>shap_int_iris</span>,
                           x<span class='op'>=</span><span class='st'>"Petal.Length"</span>,
                           y <span class='op'>=</span> <span class='st'>"Petal.Width"</span>,
                           color_feature <span class='op'>=</span> <span class='st'>"Petal.Width"</span><span class='op'>)</span>
</pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Yang Liu, Allan Just.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


